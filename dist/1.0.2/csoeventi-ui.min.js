/*! Csoeventi ui Widget v1.0.2 | MIT License | powerby https://github.com/sajadweb */
class CsoeventiUi{static init(e){let t=new CsoeventiUi(e);return(async()=>{t.render()})(),t}constructor(e){this.config=e,this.isOpen=!1,this.user=null,this.id=e?.id||"csoeventi-ui",this.apiUrl=e?.apiUrl||"http://api-cso.zagrosagency.xyz",this.date=new Date,this.year=this.date.getFullYear(),this.month=this.date.getMonth(),this.months=["January","February","March","April","May","June","July","August","September","October","November","December"]}log(...e){this.config?.debug&&console.log("CsoeventiUi",e)}renderSuccess(){document.getElementById(this.id).innerHTML=`
         <div class="calendar-info">
            <span class="icon-back" id="backBtn" style="display:block;">
                <span class="material-symbols-rounded">arrow_back</span>
            </span>
            
            <div class="specialist-title">Specialist CSO</div>
            <div class="calendar-success" style="display:block;">
              <div class="calendar-success-icon">
                <span class="material-symbols-rounded" style="font-size:48px;color:#4caf50;">check_circle</span>
              </div>
              <div class="calendar-success-title" style="font-size:1.3em;font-weight:bold;margin-top:10px;">
                Event scheduled successfully!
              </div>
              <div class="calendar-success-desc" style="margin-top:8px;">
                Thank you for booking your appointment. A confirmation email has been sent.
              </div>
            </div>

        </div> 
      `,this.addEventListeners()}render(){document.getElementById(this.id).innerHTML=`
         <div class="calendar-info">
            <span class="icon-back" onclick="backBtn()">
                <span class="material-symbols-rounded">arrow_back</span>
            </span>
            
            <div class="specialist-title">Specialist CSO</div>
            <h1 class="main-title">Book an appointment with one of our product specialists</h1>
            <div class="info-row">
                <span class="material-symbols-rounded icon">schedule</span>
                <span class="info-text">1 hr</span>
            </div>
            <div class="info-row">
                <span class="material-symbols-rounded icon">videocam</span>
                <span class="info-text bold">Web conferencing details provided upon confirmation.</span>
            </div>
            <p class="description">
                Choose the date and time to book an appointment with a CSO product specialist to find out in detail the
                news and features of our products.
            </p>

        </div>
        <div class="calendar">
            <div class="calendar-container">
                <header class="calendar-header">
                    <p class="calendar-current-date"></p>
                    <div class="calendar-navigation">
                        <span id="calendar-prev" class="material-symbols-rounded">
                            chevron_left
                        </span>
                        <span id="calendar-next" class="material-symbols-rounded">
                            chevron_right
                        </span>
                    </div>
                </header>

                <div class="calendar-body">
                    <ul class="calendar-weekdays">
                        <li>Sun</li>
                        <li>Mon</li>
                        <li>Tue</li>
                        <li>Wed</li>
                        <li>Thu</li>
                        <li>Fri</li>
                        <li>Sat</li>
                    </ul>
                    <ul class="calendar-dates"></ul>
                </div>



            </div>
            <div class="calendar-events">


                <div class="calendar-events-date">Thursday, May 29</div>
                <!--  -->
                <div class="calendar-times">
                     
                </div>
            </div>
        </div>
        <div class="calendar-form">

            <div class="calendar-form-container">
                <h2>Enter Details</h2>
                <form id="form" >
                    <label class="calendar-form-label" for="name">Name <span class="required">*</span></label>
                    <input class="calendar-form-input" type="text" id="name" name="name" required>
   <input style="display:none;" type="text" id="date" name="date" required>
                    <label class="calendar-form-label" for="email">Email <span class="required">*</span></label>
                    <input class="calendar-form-input" type="email" id="email" name="email" required>
                    <div class="calendar-form-desc" style="margin-top:18px;">
                        Please share anything that will help prepare for our meeting.
                    </div>
                    <textarea class="calendar-form-textarea" id="description" name="description" rows="3"></textarea>

                    <div class="calendar-form-terms">
                        By proceeding, you confirm that you have read and agree to
                        <a href="#" target="_blank">Calendly's Terms of Use</a> and
                        <a href="#" target="_blank">Privacy Notice</a>.
                    </div>
                    <button type="submit" class="calendar-form-submit">Schedule Event</button>
                </form>
            </div>
        </div>
      `,this.loadCalendar(),this.addEventListeners()}async callApi({method:e="GET",url:t,date:a}){this.log("siteKey",this.config.sitekey);try{return await(await fetch(this.apiUrl+"/"+t,{method:e,headers:{accept:"*/*","Content-Type":"application/json","site-key":this.config.sitekey},body:a?JSON.stringify(a):""})).json()}catch(e){return null}}addEventListeners(){var e=document.querySelector("#form"),e=(e&&e.addEventListener("submit",async e=>{e.preventDefault();e=new FormData(e.target.closest("form")),e=Object.fromEntries(e);try{var t=(e.name||"").trim().split(" "),a=t[0]||"",s=1<t.length?t.slice(1).join(" "):"",n=await this.callApi({method:"POST",url:"appointments",date:{...e,firstName:a,lastName:s,duration:60}});if(console.log("response addEventListeners",n),n&&n?._id)return this.renderSuccess();alert("Error scheduling event. Please try again later.")}catch(e){alert("An error occurred while scheduling the event. Please try again later.")}}),document.querySelectorAll(".calendar-navigation span")),e=(e&&0<e.length&&e.forEach(e=>{e.addEventListener("click",()=>{this.month="calendar-prev"===e.id?this.month-1:this.month+1,this.month<0||11<this.month?(this.date=new Date(this.year,this.month,(new Date).getDate()),this.year=date.getFullYear(),this.month=date.getMonth()):this.date=new Date,this.loadCalendar()})}),document.getElementById("backBtn"));e&&e.addEventListener("click",()=>{this.render()})}async loadCalendar(){var e=document.querySelector(".calendar-dates"),t=document.querySelector(".calendar-current-date"),a=new Date(this.year,this.month,1).getDay(),s=new Date(this.year,this.month+1,0).getDate(),n=new Date(this.year,this.month,s).getDay(),i=new Date(this.year,this.month,0).getDate();let l="";for(let e=a;0<e;e--)l+=`<li class="inactive">${i-e+1}</li>`;for(let e=1;e<=s;e++){var r=new Date(this.year,this.month,e).setHours(0,0,0,0)>(new Date).setHours(0,0,0,0)&&0!==new Date(this.year,this.month,e).getDay()&&6!==new Date(this.year,this.month,e).getDay()?"active":"";l+=`<li 
      id="${this.year}-${this.month}-${e}" 
      class="${r}" onclick="selectDate(${this.year},${this.month},${e})">${e}</li>`}for(let e=n;e<6;e++)l+=`<li class="inactive">${e-n+1}</li>`;t.innerText=this.months[this.month]+" "+this.year,e.innerHTML=l}}function selectDate(t,a,s){let e=new Date(t,a,s);var n=new Date;if(n.setHours(0,0,0,0),e.setHours(0,0,0,0),e<n)alert("You cannot schedule a meeting in the past.");else if(0===e.getDay()||6===e.getDay())alert("You cannot schedule a meeting on Saturday or Sunday.");else{n=document.querySelectorAll(".active-event"),n=(n&&n.forEach(e=>e.classList.toggle("active-event")),t+`-${a}-`+s),n=(document.getElementById(n).classList.toggle("active-event"),document.querySelector(".calendar-events")),n=(n&&(n.style.display="flex"),document.querySelector(".calendar-events-date"));if(n){let e=new Date(t,a,s);n.innerText=e.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}let e=["09:00am","10:00am","11:00am","02:00pm","03:00pm"];5===new Date(t,a,s).getDay()&&(e=["09:00am","10:00am","11:00am","12:00am"]);n=document.querySelector(".calendar-times");n&&(n.innerHTML=`
         ${e.map(e=>`
            <button id="btn-${e}" class="calendar-time-btn" 
            onclick="sctBtn('${e}')">
                        ${e}
                    </button>
                    <div id="next-${e}" class="calendar-events-top" style="display: none;">
                        <button class="calendar-btn selected"
                          >${e}</button>
                        <button onclick="sctNextBtn(${t}, ${a}, ${s},'${e}')" class="calendar-btn next">Next</button>
                    </div>
            `).join("")}
    `)}}function sctBtn(t){var a,s,n=document.querySelectorAll(".calendar-events-top");for(let e=0;e<n.length;e++){var i=n[e];"next-"+t===i.id?(s=i).style.display="block":i.style.display="none"}var l=document.querySelectorAll(".calendar-time-btn");for(let e=0;e<l.length;e++){var r=l[e];"btn-"+t===r.id?(a=r).style.display="none":(r.style.display="block",r.style.transform="none",r.style.opacity="1")}a&&(a.style.transition="transform 0.3s ease, opacity 0.3s ease",a.style.transform="translateX(-100%)",a.style.opacity="0",setTimeout(()=>{a.style.display="none"},300)),s&&(s.style.display="block",s.style.transition="transform 0.3s ease, opacity 0.3s ease",s.style.transform="translateX(-100%)",s.style.opacity="0",s.offsetWidth,s.style.transform="translateX(0)",s.style.opacity="1")}function sctNextBtn(a,s,n,i){var l=document.querySelector("#date");if(l){var[i,r]=i.match(/(\d{2}:\d{2})(am|pm)/i).slice(1,3);let[e,t]=i.split(":").map(Number);"pm"===r.toLowerCase()&&12!==e&&(e+=12),"am"===r.toLowerCase()&&12===e&&(e=0),l.value=`${a}-${String(s+1).padStart(2,"0")}-${String(n).padStart(2,"0")}T${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}:00.000Z`}i=document.querySelector(".calendar"),i&&(i.style.display="none"),r=document.querySelector(".calendar-form"),r&&(r.style.display="block"),l=document.querySelector(".icon-back");l&&(l.style.display="block")}function backBtn(){var e=document.querySelector(".calendar"),e=(e&&(e.style.display="flex"),document.querySelector(".calendar-form")),e=(e&&(e.style.display="none"),document.querySelector(".icon-back"));e&&(e.style.display="none")}